<!doctype html><html lang=en><head><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-62096468-12','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content=#2D9AED><title>KubeDB Home</title><meta name=description content="Accelerating the transition to Containers by building a Kubernetes-native Cloud"><meta name=author content="AppsCode Inc."><meta name=keywords content="application monitoring,attic,build docker image,cloud app,cloud deployment,cloud hosting,container applications,continuous deployment,deployment automation,git hosting,kubernetes autoscaling,nagios,network monitor,repository hosting,source code repository"><link rel=apple-touch-icon sizes=57x57 href=/assets/images/products/appscode/icons/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/assets/images/products/appscode/icons/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/assets/images/products/appscode/icons/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/assets/images/products/appscode/icons/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/assets/images/products/appscode/icons/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/assets/images/products/appscode/icons/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/assets/images/products/appscode/icons/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/assets/images/products/appscode/icons/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/assets/images/products/appscode/icons/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/assets/images/products/appscode/icons/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/assets/images/products/appscode/icons/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/assets/images/products/appscode/icons/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/assets/images/products/appscode/icons/favicon-16x16.png><link rel=manifest href=/assets/images/products/appscode/icons/manifest.json><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-TileImage content=/assets/images/products/appscode/icons/ms-icon-144x144.png><meta name=theme-color content=#ffffff><meta name=twitter:card content=summary><meta name=twitter:site content=@KubeDB><meta name=twitter:title content=KubeDB><meta name=twitter:creator content=@KubeDB><meta name=twitter:description content="KubeDB by AppsCode simplifies and automates routine database tasks such as provisioning, patching, backup, recovery, failure detection, and repair for various popular databases on private and public clouds"><meta name=twitter:image:src content=/assets/images/products/kubedb/kubedb-1280x640.png><meta property=og:url content=https://kubedb.com><meta property=og:title content=KubeDB><meta property=og:description content="KubeDB by AppsCode simplifies and automates routine database tasks such as provisioning, patching, backup, recovery, failure detection, and repair for various popular databases on private and public clouds"><meta property=og:site_name content=KubeDB><meta property=og:image content=/assets/images/products/kubedb/kubedb-1280x640.png><meta property=og:type content=article><link rel=stylesheet href=/assets/css/font-awesome.min.css><link rel=stylesheet href=/assets/css/bulma-carousel.min.css><link rel=stylesheet href=/assets/css/bulma-tooltip.min.css><link rel=stylesheet href=/assets/css/bulma.min.css><link rel=stylesheet href=/assets/sass/main.min.79d2ca4efe824390400b870828af11def47311553c8cd1ccc9fc81efedc2da5a.css></head><body class=kubedb><header><div class=header-top><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://appscode.com><img src=https://cdn.appscode.com/images/products/appscode/appscode.png alt=AppsCode></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav1><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav1 class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Products</a><div class=ac-megamenu><div class=columns><div class="column is-8"><div class=columns><div class="column is-6 br-1"><a href=https://kubedb.com class="single-product-item is-kubedb"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/kubedb/kubedb-icon.png alt=KubeDB></div><h5>KubeDB</h5></div><div class=menu-body><p>Run production-grade databases easily on Kubernetes</p></div></a><a href=https://appscode.com/products/stash/ class="single-product-item is-stash"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/stash/stash-icon.png alt=Stash></div><h5>Stash</h5></div><div class=menu-body><p>Backup your Kubernetes Stateful Applications</p></div></a><a href=https://kubevault.com class="single-product-item is-kubevault"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/kubevault/kubevault-icon.png alt=KubeVault></div><h5>KubeVault</h5></div><div class=menu-body><p>Tools for running HashiCorp Vault on Kubernetes</p></div></a><a href=https://appscode.com/products/guard/ class="single-product-item is-guard"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/guard/guard-icon.png alt=Guard></div><h5>Guard</h5></div><div class=menu-body><p>Kubernetes Authentication WebHook Server</p></div></a></div><div class="column is-6 br-1"><a href=https://appscode.com/products/voyager/ class="single-product-item is-voyager"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/voyager/voyager-icon.png alt=Voyager></div><h5>Voyager</h5></div><div class=menu-body><p>Secure HAProxy Ingress Controller for
Kubernetes</p></div></a><a href=https://appscode.com/products/swift/ class="single-product-item is-swift"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/swift/swift-icon.png alt=Swift></div><h5>Swift</h5></div><div class=menu-body><p>Ajax friendly Helm Tiller Proxy</p></div></a><a href=https://appscode.com/products/searchlight/ class="single-product-item is-searchlight"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/searchlight/searchlight-icon.png alt=Searchlight></div><h5>Searchlight</h5></div><div class=menu-body><p>Alerts for Kubernetes</p></div></a><a href=https://appscode.com/products/kubed/ class="single-product-item is-kubed"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/kubed/kubed-icon.png alt=Kubed></div><h5>Kubed</h5></div><div class=menu-body><p>Kubernetes cluster manager daemon</p></div></a></div></div></div><div class="column is-4"><div class=columns><div class="column is-12"><a href=https://byte.builders class="single-product-item byte-builder kd-orange"><div class=menu-header><p class=intro>Introducing....</p><h5>ByteBuilders</h5></div><div class=menu-body><p>Cloud reimagined for the age of Kubernetes</p></div><p class=learn-more-btn>Learn more
<span class=icon><i class="fa fa-long-arrow-right" aria-hidden=true></i></span></p></a><a href=https://pharmer.io class="single-product-item is-pharmer"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/pharmer/pharmer-icon.png alt=Pharmer></div><h5>Pharmer</h5></div><div class=menu-body><p>Kubernetes Cluster Manager using Kubeadm &amp; Cluster API</p></div></a><a href=https://kubeform.com class="single-product-item is-kubeform"><div class=menu-header><div class=menu-logo><img src=https://cdn.appscode.com/images/products/kubeform/kubeform-icon.png alt=Kubeform></div><h5>Kubeform</h5></div><div class=menu-body><p>Provision cloud resources using Kubernetes CRDs &amp; Terraform</p></div></a></div></div></div></div><div class="columns has-text-centered"><div class=column><div class=menu-bottom><p>Explore apps and integrations for AppsCode products:
<a href=https://marketplace.byte.builders>Visit the Marketplace
<i class="fa fa-long-arrow-right" aria-hidden=true></i></a></p></div></div></div></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Services</a><div class=ac-dropdown><a class=navbar-item href=https://appscode.com/consulting/>Consulting</a>
<a class=navbar-item href=https://appscode.com/training/>Training</a>
<a class=navbar-item href=https://appscode.com/support/>Support</a></div></div><a class=navbar-item href=https://blog.byte.builders>Blog</a>
<a class=navbar-item href=https://appscode.com/contact/>Contact Us</a></div><div class=navbar-item><div class="buttons main-menu-button-top"><a class="button is-small for-chat" href=https://slack.appscode.com><span><img src=/assets/images/icon/slack.png alt></span>Slack</a>
<a class="button is-small for-support" href=https://appscode.freshdesk.com><span><img src=/assets/images/icon/chat.png alt></span>Support Portal</a></div></div></div></div></nav></div></div><div class="header-bottom-area header-area kubedb-primary-bg customize-kubedb fixed-menu"><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://kubedb.com><img src=https://cdn.appscode.com/images/products/kubedb/kubedb-white.png alt=KubeDB></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><a href=/features/ class=navbar-item>Features</a>
<a href=/pricing/ class=navbar-item>Commercial Support</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Databases</a><div class=ac-dropdown><a class=navbar-item href=/docs/v0.13.0-rc.0/guides/elasticsearch/>Elasticsearch</a>
<a class=navbar-item href=/docs/v0.13.0-rc.0/guides/memcached/>Memcached</a>
<a class=navbar-item href=/docs/v0.13.0-rc.0/guides/mongodb/>MongoDB</a>
<a class=navbar-item href=/docs/v0.13.0-rc.0/guides/mysql/>MySQL</a>
<a class=navbar-item href=/docs/v0.13.0-rc.0/guides/postgres/>PostgreSQL</a>
<a class=navbar-item href=/docs/v0.13.0-rc.0/guides/redis/>Redis</a></div></div><a href=/docs/v0.13.0-rc.0/welcome/ class=navbar-item>Documentation</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Community</a><div class=ac-dropdown><a href=https://github.com/kubedb class=navbar-item>GitHub</a>
<a href=https://twitter.com/KubeDB class=navbar-item>Twitter</a>
<a href=http://slack.kubernetes.io/ class=navbar-item>Slack</a></div></div></div><div class=navbar-item><div class="buttons main-menu-button"><img style=height:24px alt="GitHub Stars" src="https://img.shields.io/github/stars/kubedb/cli?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=github">
&nbsp;&nbsp;&nbsp;
<img style=height:24px alt="Docker Pulls" src="https://img.shields.io/docker/pulls/kubedb/operator?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=docker"></div></div></div></div></nav></div></div><div class=documentation-menu><div class="container section"><div class=is-centered><div class="is-half has-text-centered-desktop"><div class=responsive-menu><a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav3><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><nav class=documentation-navbar><div id=acNav3 class="navbar-menu nav-menu main-menu"><div class=navbar-centered><div class=navbar-start><a href=/docs/0.10.0/ class=navbar-item>Welcome</a>
<a href=/docs/0.10.0/concepts/ class=navbar-item>Concepts</a>
<a href=/docs/0.10.0/setup/ class=navbar-item>Setup</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Guides</a><div class=ac-dropdown><a href=/docs/0.10.0/guides/elasticsearch/ class=navbar-item>Elasticsearch</a>
<a href=/docs/0.10.0/guides/memcached/ class=navbar-item>Memcached</a>
<a href=/docs/0.10.0/guides/mongodb/ class=navbar-item>MongoDB</a>
<a href=/docs/0.10.0/guides/mysql/ class=navbar-item>MySQL</a>
<a href=/docs/0.10.0/guides/postgres/ class=navbar-item>PostgreSQL</a>
<a href=/docs/0.10.0/guides/redis/ class=navbar-item>Redis</a></div></div><a href=/docs/0.10.0/reference/ class=navbar-item>Reference</a></div></div></div></nav></div></div></div></div></header><div class=documentation-area><div class="container section"><div class=columns><div class="column is-3"><div class=kd-left-sidebar><div class=trial-button><a href=/docs/v0.13.0-rc.0/setup/ class="button is-fullwidth">Try Now for FREE!</a></div><div class=kd-version><div class=dropdown><div class=dropdown-trigger><button class="button is-fullwidth" aria-haspopup=true aria-controls=dropdown-menu3>
<span><strong class=icon><i class="fa fa-cog" aria-hidden=true></i></strong>0.10.0</span>
<span class="icon is-small"><i class="fa fa-angle-down" aria-hidden=true></i></span></button></div><div class=dropdown-menu id=dropdown-menu3 role=menu><div class=dropdown-content><a href=https://github.com/kubedb/docs/tree/master/docs target=_blank class=dropdown-item>master</a>
<a href=/docs/v0.13.0-rc.0/ class=dropdown-item>v0.13.0-rc.0<div class=tag>Latest</div></a><a href=/docs/0.12.0/ class=dropdown-item>0.12.0</a>
<a href=/docs/0.11.0/ class=dropdown-item>0.11.0</a>
<a href=/docs/0.10.0/ class=dropdown-item>0.10.0</a>
<a href=/docs/0.9.0/ class=dropdown-item>0.9.0</a>
<a href=/docs/0.8.0/ class=dropdown-item>0.8.0</a>
<a href=https://github.com/kubedb/docs/tree/0.6.0/docs target=_blank class=dropdown-item>0.6.0</a></div></div></div></div><div class=kd-sidebar-menu><div class=item><input type=checkbox id=a5ab135298aa7680c928f23039aab620-1>
<label for=a5ab135298aa7680c928f23039aab620-1><a href=/docs/0.10.0/guides/>Redis</a></label></div><div class=item><input type=checkbox id=a5ab135298aa7680c928f23039aab620-2>
<label for=a5ab135298aa7680c928f23039aab620-2><a href=/docs/0.10.0/guides/redis/>Redis</a></label></div><div class=item><input type=checkbox id=a5ab135298aa7680c928f23039aab620-3>
<label for=a5ab135298aa7680c928f23039aab620-3><a>Quickstart</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/0.10.0/guides/redis/quickstart/quickstart/>Overview</a></li></ul></div></div><div class=item><input type=checkbox id=a5ab135298aa7680c928f23039aab620-4 checked>
<label for=a5ab135298aa7680c928f23039aab620-4><a>Clustering</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li class=is-active><a href=/docs/0.10.0/guides/redis/clustering/overview/>Overview</a></li><li><a href=/docs/0.10.0/guides/redis/clustering/redis-cluster/>Clustering Guide</a></li></ul></div></div><div class=item><input type=checkbox id=a5ab135298aa7680c928f23039aab620-5>
<label for=a5ab135298aa7680c928f23039aab620-5><a>Private Registry</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/0.10.0/guides/redis/private-registry/using-private-registry/>Quickstart</a></li></ul></div></div><div class=item><input type=checkbox id=a5ab135298aa7680c928f23039aab620-6>
<label for=a5ab135298aa7680c928f23039aab620-6><a>Monitoring</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/0.10.0/guides/redis/monitoring/using-builtin-prometheus/>Builtin Prometheus Discovery</a></li><li><a href=/docs/0.10.0/guides/redis/monitoring/using-coreos-prometheus-operator/>Coreos Prometheus Operator</a></li></ul></div></div><div class=item><input type=checkbox id=a5ab135298aa7680c928f23039aab620-7>
<label for=a5ab135298aa7680c928f23039aab620-7><a>Cli</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/0.10.0/guides/redis/cli/cli/>Quickstart</a></li></ul></div></div><div class=item><input type=checkbox id=a5ab135298aa7680c928f23039aab620-8>
<label for=a5ab135298aa7680c928f23039aab620-8><a>Custom Configuration</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/0.10.0/guides/redis/custom-config/using-custom-config/>Quickstart</a></li></ul></div></div></div></div></div><div class="column is-7"><div class=full-info><blockquote><p>New to KubeDB? Please start <a href=/docs/0.10.0/concepts/README>here</a>.</p></blockquote><h1 id=redis-cluster>Redis Cluster</h1><p>Redis Cluster provides a way to partition data among multiple master nodes (data sharding) and ensures data availability. Each of the master nodes may have its own replicas. The cluster member nodes (both masters and replicas) detect failures via internal interconnection among themselves. When a majority of nodes agree with the failure of a master node, one of the replicas of the failed master node is promoted to the new master.</p><p>So basically it is a group of multiple Redis nodes where data is <strong>automatically sharded across multiple Redis nodes</strong>. And it also provides <strong>some degree of availability during partitions</strong>, that is in practical terms the ability to continue the operations when some nodes fail or are not able to communicate. However, the cluster stops to operate in the event of larger failures (for example when the majority of masters are unavailable).</p><p>So in practical terms, what do you get with Redis Cluster?</p><ul><li>The ability to <strong>automatically split your dataset among multiple nodes</strong>.</li><li>The ability to <strong>continue operations when a subset of the nodes are experiencing failures</strong> or are unable to communicate with the rest of the cluster. See the <a href=https://redis.io/topics/cluster-tutorial#redis-cluster-101>reference</a>.</li></ul><p><img src=/docs/0.10.0/images/redis/redis-cluster.png alt=redis-cluster></p><blockquote><p>Image reference <a href=https://redislabs.com/redis-features/redis-cluster>here</a>.</p></blockquote><h2 id=redis-cluster-tcp-ports>Redis Cluster TCP ports</h2><p>Every Redis Cluster node requires two TCP connections open. The normal Redis TCP port used to serve clients, for example 6379, plus the port obtained by adding 10000 to the data port, so 16379 in the example.</p><p>This second <em>high</em> port is used for the Cluster bus, that is a node-to-node communication channel using a binary protocol. The Cluster bus is used by nodes for failure detection, configuration update, failover authorization and so forth. Clients should never try to communicate with the cluster bus port, but always with the normal Redis command port, however make sure you open both ports in your firewall, otherwise Redis cluster nodes will be not able to communicate.</p><p>The command port and cluster bus port offset is fixed and is always 10000.</p><p>Note that for a Redis Cluster to work properly you need, for each node:</p><ol><li>The normal client communication port (usually 6379) used to communicate with clients to be open to all the clients that need to reach the cluster, plus all the other cluster nodes (that use the client port for keys migrations).</li><li>The cluster bus port (the client port + 10000) must be reachable from all the other cluster nodes.</li></ol><p>If you don&rsquo;t open both TCP ports, your cluster will not work as expected.</p><p>The cluster bus uses a different, binary protocol, for node to node data exchange, which is more suited to exchange information between nodes using little bandwidth and processing time.</p><p>Reference: <a href=https://redis.io/topics/cluster-tutorial#redis-cluster-tcp-ports>https://redis.io/topics/cluster-tutorial#redis-cluster-tcp-ports</a></p><h2 id=redis-cluster-data-sharding>Redis Cluster data sharding</h2><p>Redis Cluster does not use consistent hashing, but a different form of sharding where every key is conceptually part of what we call a <strong>hash slot</strong>.</p><p>There are in total 16384 hash slots in Redis Cluster, and to compute what is the hash slot of a given key, it simply takes the CRC16 of the key modulo 16384.</p><p>Every node in a Redis Cluster is responsible for a subset of the hash slots, so, for example, you may have a cluster with 3 nodes, where:</p><ul><li>Node A contains hash slots from 0 to 5500.</li><li>Node B contains hash slots from 5501 to 11000.</li><li>Node C contains hash slots from 11001 to 16383.</li></ul><p>This allows to add and remove nodes in the cluster easily. For example if one wants to add a new node D, he/she needs to move some hash slots from nodes A, B, C to D. Similarly if he/she wants to remove node A from the cluster he/she can just move the hash slots served by A to B and C. When the node A will be empty he/she can remove it from the cluster completely.</p><p>Because moving hash slots from a node to another does not require to stop operations, adding and removing nodes, or changing the percentage of hash slots hold by nodes, does not require any downtime.</p><p>Reference: <a href=https://redis.io/topics/cluster-tutorial#redis-cluster-data-sharding>https://redis.io/topics/cluster-tutorial#redis-cluster-data-sharding</a></p><h2 id=redis-cluster-master-slave-model>Redis Cluster master-slave model</h2><p>In order to ensure availability when a subset of master nodes are failing or are not able to communicate with the majority of nodes, Redis Cluster uses a master-slave model where every hash slot has from 1 (the master itself) to N replicas (N-1 additional replicas nodes).</p><p>In our example cluster with nodes A, B, C, if node B fails the cluster is not able to continue since we no longer have a way to serve hash slots in the range 5501-11000.</p><p>However when the cluster is created (or at a later time) we add a slave node to every master, so that the final cluster is composed of A, B, C those are master nodes, and A1, B1, C1 are slave nodes, the system is able to continue if node B fails.</p><p>Node B1 replicates B, and B fails, the cluster will promote node B1 as the new master and will continue to operate correctly.</p><p>However, note that if nodes B and B1 fail at the same time Redis Cluster is not able to continue to operate.</p><p>Reference: <a href=https://redis.io/topics/cluster-tutorial#redis-cluster-master-slave-model>https://redis.io/topics/cluster-tutorial#redis-cluster-master-slave-model</a></p><h2 id=redis-cluster-consistency-guarantees>Redis Cluster consistency guarantees</h2><p>Redis Cluster is not able to guarantee <strong>strong consistency</strong>. In practical terms, this means that under certain conditions it is possible that Redis Cluster will lose writes that were acknowledged by the system to the client.</p><p>The first reason why Redis Cluster can lose writes because it uses asynchronous replication. This means that during writes the following happens:</p><ul><li>Your client writes to the master B.</li><li>The master B replies OK to your client.</li><li>The master B propagates the write to its replicas B1, B2, and B3.</li></ul><p>As you can see B does not wait for an acknowledge from B1, B2, B3 before replying to the client, since this would be a prohibitive latency penalty for Redis, so if your client writes something, B acknowledges the write, but crashes before being able to send the write to its replicas, one of the replicas (that did not receive the write) can be promoted to master, losing the write forever.</p><p>This is <strong>very similar to what happens</strong> with most databases that are configured to flush data to disk every second, so it is a scenario you are already able to reason about because of past experiences with traditional database systems not involving distributed systems. Similarly, you can improve consistency by forcing the database to flush data on disk before replying to the client, but this usually results in prohibitively low performance. That would be the equivalent of synchronous replication in the case of Redis Cluster.</p><p>Basically, there is a trade-off to take between performance and consistency.</p><p>Redis Cluster has support for synchronous writes when absolutely needed, implemented via the <a href=https://redis.io/commands/wait>WAIT</a> command, this makes losing writes a lot less likely, however note that Redis Cluster does not implement strong consistency even when synchronous replication is used: it is always possible under more complex failure scenarios that a slave that was not able to receive the write is elected as master.</p><p>There is another notable scenario where Redis Cluster will lose writes, that happens during a network partition where a client is isolated with a minority of instances including at least a master.</p><p>Take as an example our 6 nodes cluster composed of A, B, C, A1, B1, C1, with 3 masters and 3 replicas. There is also a client, that we will call Z1.</p><p>After a partition occurs, it is possible that on one side of the partition we have A, C, A1, B1, C1, and on the other side, we have B and Z1.</p><p>Z1 is still able to write to B, that will accept its writes. If the partition heals in a very short time, the cluster will continue normally. However, if the partition lasts enough time for B1 to be promoted to master in the majority side of the partition, the writes that Z1 is sending to B will be lost.</p><p>Reference: <a href=https://redis.io/topics/cluster-tutorial#redis-cluster-consistency-guarantees>https://redis.io/topics/cluster-tutorial#redis-cluster-consistency-guarantees</a></p><h2 id=redis-cluster-configuration-parameters>Redis Cluster configuration parameters</h2><p>We are about to create an example cluster deployment. Before we continue, let&rsquo;s introduce the configuration parameters that Redis Cluster introduces in the <code>redis.conf</code> file. Some will be obvious, others will be more clear as you continue reading.</p><ul><li><strong>cluster-enabled <yes/no></strong>: If yes enables Redis Cluster support in a specific Redis instance. Otherwise the instance starts as a stand alone instance as usual.</li><li><strong>cluster-config-file <filename></strong>: Note that despite the name of this option, this is not an user editable configuration file, but the file where a Redis Cluster node automatically persists the cluster configuration (the state, basically) every time there is a change, in order to be able to re-read it at startup. The file lists things like the other nodes in the cluster, their state, persistent variables, and so forth. Often this file is rewritten and flushed on disk as a result of some message reception.</li><li><strong>cluster-node-timeout <milliseconds></strong>: The maximum amount of time a Redis Cluster node can be unavailable, without it being considered as failing. If a master node is not reachable for more than the specified amount of time, it will be failed over by its replicas. This parameter controls other important things in Redis Cluster. Notably, every node that can&rsquo;t reach the majority of master nodes for the specified amount of time, will stop accepting queries.</li><li><strong>cluster-slave-validity-factor <factor></strong>: If set to zero, a slave will always try to failover a master, regardless of the amount of time the link between the master and the slave remained disconnected. If the value is positive, a maximum disconnection time is calculated as the <em>node timeout</em> value multiplied by the factor provided with this option, and if the node is a slave, it will not try to start a failover if the master link was disconnected for more than the specified amount of time. For example if the node timeout is set to 5 seconds, and the validity factor is set to 10, a slave disconnected from the master for more than 50 seconds will not try to failover its master. Note that any value different than zero may result in Redis Cluster to be unavailable after a master failure if there is no slave able to failover it. In that case the cluster will return back available only when the original master rejoins the cluster.</li><li><strong>cluster-migration-barrier <count></strong>: Minimum number of replicas a master will remain connected with, for another slave to migrate to a master which is no longer covered by any slave. See the appropriate section about replica migration in this tutorial for more information.</li><li><strong>cluster-require-full-coverage <yes/no></strong>: If this is set to yes, as it is by default, the cluster stops accepting writes if some percentage of the key space is not covered by any node. If the option is set to no, the cluster will still serve queries even if only requests about a subset of keys can be processed.</li></ul><p>Reference: <a href=https://redis.io/topics/cluster-tutorial#redis-cluster-configuration-parameters>https://redis.io/topics/cluster-tutorial#redis-cluster-configuration-parameters</a></p><p>For more parameters, see <a href=http://download.redis.io/redis-stable/redis.conf>here</a>.</p><h2 id=redis-cluster-main-components>Redis Cluster main components</h2><ul><li><strong>Keys distribution model</strong>: The key space is split into 16384 slots, effectively setting an upper limit for the cluster size of 16384 master nodes (however the suggested max size of nodes is in the order of ~ 1000 nodes).</li></ul><p>Each master node in a cluster handles a subset of the 16384 hash slots. The cluster is <strong>stable</strong> when there is no cluster reconfiguration in progress (i.e. where hash slots are being moved from one node to another). When the cluster is stable, a single hash slot will be served by a single node (however the serving node can have one or more replicas that will replace it in the case of net splits or failures, and that can be used in order to scale read operations where reading stale data is acceptable).</p><p>Reference: <a href=https://redis.io/topics/cluster-spec#keys-distribution-model>https://redis.io/topics/cluster-spec#keys-distribution-model</a></p><ul><li><strong>Keys hash tags</strong>: There is an exception for the computation of the hash slot that is used in order to implement <strong>hash tags</strong>. Hash tags are a way to ensure that multiple keys are allocated in the same hash slot. This is used in order to implement multi-key operations in Redis Cluster.</li></ul><p>Reference: <a href=https://redis.io/topics/cluster-spec#keys-hash-tags>https://redis.io/topics/cluster-spec#keys-hash-tags</a></p><ul><li><strong>Cluster nodes&rsquo; attributes</strong>: Every node has a unique name in the cluster. The node name is the hex representation of a 160 bit random number, obtained the first time a node is started (usually using /dev/urandom). The node will save its ID in the node configuration file, and will use the same ID forever, or at least as long as the node configuration file is not deleted by the system administrator, or a <em>hard reset</em> is requested via the <a href=https://redis.io/commands/cluster-reset>CLUSTER RESET</a> command.</li></ul><p>A detailed <a href=http://redis.io/commands/cluster-nodes>explanation of all the node fields</a> is described in the <a href=https://redis.io/commands/cluster-nodes>CLUSTER NODES</a> documentation.</p><p>The following is sample output of the <a href=https://redis.io/commands/cluster-nodes>CLUSTER NODES</a> command sent to a master node in a small cluster of three nodes.</p><pre><code class=language-console>  $ redis-cli cluster nodes
  d1861060fe6a534d42d8a19aeb36600e18785e04 127.0.0.1:6379 myself - 0 1318428930 1 connected 0-1364
  3886e65cc906bfd9b1f7e7bde468726a052d1dae 127.0.0.1:6380 master - 1318428930 1318428931 2 connected 1365-2729
  d289c575dcbc4bdd2931585fd4339089e461a27d 127.0.0.1:6381 master - 1318428931 1318428931 3 connected 2730-4095
</code></pre><p>Reference: <a href=https://redis.io/topics/cluster-spec#cluster-nodes-attributes>https://redis.io/topics/cluster-spec#cluster-nodes-attributes</a></p><ul><li><strong>The Cluster bus</strong>: Every Redis Cluster node has an additional TCP port for receiving incoming connections from other Redis Cluster nodes. This port is at a fixed offset from the normal TCP port used to receive incoming connections from clients. To obtain the Redis Cluster port, 10000 should be added to the normal commands port. For example, if a Redis node is listening for client connections on port 6379, the Cluster bus port 16379 will also be opened.</li></ul><p>Reference: <a href=https://redis.io/topics/cluster-spec#the-cluster-bus>https://redis.io/topics/cluster-spec#the-cluster-bus</a></p><ul><li><strong>Cluster topology</strong>: Redis Cluster is a full mesh where every node is connected with every other node using a TCP connection.</li></ul><p>In a cluster of N nodes, every node has N-1 outgoing TCP connections and N-1 incoming connections.</p><p>These TCP connections are kept alive all the time and are not created on demand. When a node expects a pong reply in response to a ping in the cluster bus, before waiting long enough to mark the node as unreachable, it will try to refresh the connection with the node by reconnecting from scratch.</p><p>Reference: <a href=https://redis.io/topics/cluster-spec#cluster-topology>https://redis.io/topics/cluster-spec#cluster-topology</a></p><ul><li><strong>Nodes handshake</strong>: Nodes always accept connections on the cluster bus port, and even reply to pings when received, even if the pinging node is not trusted. However, all other packets will be discarded by the receiving node if the sending node is not considered part of the cluster.</li></ul><p>A node will accept another node as part of the cluster only in two ways:</p><ul><li><p>If a node presents itself with a <code>MEET</code> message. A meet message is exactly like a <a href=https://redis.io/commands/ping>PING</a> message but forces the receiver to accept the node as part of the cluster. Nodes will send <code>MEET</code> messages to other nodes <strong>only if</strong> the system administrator requests this via the following command:</p><pre><code class=language-console>$ CLUSTER MEET ip port
</code></pre></li><li><p>A node will also register another node as part of the cluster if a node that is already trusted will gossip about this other node. So if A knows B, and B knows C, eventually B will send gossip messages to A about C. When this happens, A will register C as part of the network, and will try to connect with C.</p></li></ul><p>Reference: <a href=https://redis.io/topics/cluster-spec#nodes-handshake>https://redis.io/topics/cluster-spec#nodes-handshake</a></p><h2 id=next-steps>Next Steps</h2><ul><li><a href=/docs/0.10.0/guides/redis/clustering/redis-cluster>Deploy Redis Cluster</a> using KubeDB.</li><li>Detail concepts of <a href=/docs/0.10.0/concepts/databases/redis>Redis object</a>.</li><li>Detail concepts of <a href=/docs/0.10.0/concepts/catalog/redis>RedisVersion object</a>.</li><li>Want to hack on KubeDB? Check our <a href=/docs/0.10.0/CONTRIBUTING>contribution guidelines</a>.</li></ul></div></div><div class="column is-2"><div class=right-sidebar-area><div class=search-area><form action=#><input id=acSearch type=text placeholder=Search...>
<button class=search-button>
<i class="fa fa-search" aria-hidden=true></i></button></form></div><div class=tbl-of-contents><h4>What's on this Page</h4><nav id=TableOfContents><ul><li><a href=#redis-cluster>Redis Cluster</a><ul><li><a href=#redis-cluster-tcp-ports>Redis Cluster TCP ports</a></li><li><a href=#redis-cluster-data-sharding>Redis Cluster data sharding</a></li><li><a href=#redis-cluster-master-slave-model>Redis Cluster master-slave model</a></li><li><a href=#redis-cluster-consistency-guarantees>Redis Cluster consistency guarantees</a></li><li><a href=#redis-cluster-configuration-parameters>Redis Cluster configuration parameters</a></li><li><a href=#redis-cluster-main-components>Redis Cluster main components</a></li><li><a href=#next-steps>Next Steps</a></li></ul></li></ul></nav></div></div></div></div></div><script>var kdDropdown=document.querySelector(".dropdown");var kdDropdownBtn=document.querySelector(".dropdown-trigger");kdDropdownBtn.addEventListener("click",function(){kdDropdown.classList.toggle("is-active");})</script></div><div class=overlay-bg></div><div class=sidebar-search-area><div class=search-area-top><h3>Search</h3><div class=searchbar-area><input type=search name=search id=searchbox placeholder=Search...>
<button onclick=queryPage(1)><i class="fa fa-search" aria-hidden=true></i></button></div><span id=searchbar-script-container style=display:none></span><div class="search-meta-information level"><div class=level-left></div></div></div><div class=search-result-wrapper></div><div class=pagination-area><div class=pagination-list></div></div></div><script type=text/javascript>var pageSize=5;var acSearch=document.querySelector("#acSearch");var bodyOverlay=document.querySelector(".overlay-bg");var sidebarSearch=document.querySelector(".sidebar-search-area");acSearch.addEventListener("click",function(){bodyOverlay.style.display="block";sidebarSearch.style.right="0";document.getElementById("searchbox").focus();bodyOverlay.addEventListener("click",function(){bodyOverlay.style.display="none";sidebarSearch.style.right="-80%";});});function encodeQueryData(data){var ret=[];for(var d in data)
ret.push(encodeURIComponent(d)+'='+encodeURIComponent(data[d]));return ret.join('&');}
document.querySelector(".searchbar-area input[type=search]").addEventListener("keyup",function(event){event.preventDefault();if(event.keyCode===13){queryPage(1);}});function queryPage(idx){var q=document.getElementById("searchbox").value;var cx="015199383701854252104:8mvwy0fek2e";var key="AIzaSyBo15AW3hatf4fO8actJUZ_d5qZJpx0rXM";var imgSize="small";var callback="renderResult";var src="https://www.googleapis.com/customsearch/v1?"+encodeQueryData({q:q,cx:cx,key:key,imgSize:imgSize,callback:callback,start:(idx-1)*pageSize+1,num:pageSize,});var newScript=document.createElement("script");newScript.src=src;e=document.getElementById("searchbar-script-container");var child=e.lastElementChild;if(child){e.removeChild(child);}
e.appendChild(newScript);}
function renderSearchResultEntry(e){var out='<div class="single-search-result">'+
'<h3><a href="'+e.link+'">'+e.title+'</a></h3>'+
'<a href="'+e.link+'">'+e.htmlFormattedUrl+'</a>'+
'<div class="result-description-wrapper">';if(e.pagemap&&e.pagemap.cse_thumbnail){out+='<div class="result-thumb">'+
'<img src="'+e.pagemap.cse_thumbnail[0].src+'" alt="" />'+
'</div>';}
out+='<div class="result-description">'+
'<p>'+
e.snippet+
'</p>'+
'</div>'+
'</div>'+
'</div>';return out;}
function renderResult(response){document.querySelector(".search-meta-information .level-left").innerHTML='<div class="level-left">'+
'<p>'+
'About <span class="search-count">'+response.searchInformation.formattedTotalResults+'</span> results (<span class="time-count">'+response.searchInformation.formattedSearchTime+' </span>seconds)'+
'</p>'+
'</div>';if(!response.items){return;}
var searchResultWrapper=document.querySelector(".search-result-wrapper");searchResultWrapper.innerHTML="";for(var i=0;i<response.items.length;i++){searchResultWrapper.innerHTML+=renderSearchResultEntry(response.items[i]);}
var pager='<ul>';if(response.queries.previousPage){var pageIndex=Math.floor(response.queries.previousPage[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')">Previous</a></li>';}
if(response.queries.request){var pageIndex=Math.floor(response.queries.request[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')" class="is-active">'+pageIndex+'</a></li>';}
if(response.queries.nextPage){var pageIndex=Math.floor(response.queries.nextPage[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')">Next</a></li>';}
pager+='</ul>';document.querySelector(".pagination-area .pagination-list").innerHTML=pager;}</script><section></section><section></section><section></section><button class=go-to-top id=goTop>
<i class="fa fa-angle-up" aria-hidden=true></i></button><footer class=footer-area><div class=footer-top><div class="container section"><div class=columns><div class="column is-4"><div class=single-footer-widget><div class=footer-logo><a href=https://appscode.com><img src=https://cdn.appscode.com/images/products/appscode/appscode.png alt=AppsCode class=img></a></div><div class=subscription-form><form action="https://appscode.us17.list-manage.com/subscribe/post?u=feb2bf31969a951e7449048a3&amp;id=82fb19acb9" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=navbar-form target=_blank novalidate role=email role=email><label for=email>Subscribe to Our Newsletter</label><p class=spam-message>No spam, we promise. Your mail address is secure</p><div class="field has-addons"><div class=control><input class=input name=EMAIL id=mce-EMAIL type=email placeholder="Your work email address" required>
<button id=mc-embedded-subscribe type=submit name=subscribe class=button>
<i class="fa fa-paper-plane-o" aria-hidden=true></i></button></div></div></form></div><div class=contact-information><h4>Have any Inquiry?</h4><ul class=all-contact-info><li><a href=callto:&#43;1%28650%29241-8486><span><i class="fa fa-phone" aria-hidden=true></i></span>&#43;1(650)241-8486</a></li><li><a href=mailto:support@appscode.com><span><i class="fa fa-envelope-o" aria-hidden=true></i></span>support@appscode.com</a></li></ul></div></div></div><div class="column is-2"><div class=single-footer-widget><div class=footer-menu><h4>Products</h4><ul class=footer-link><li><a href=https://kubedb.com>KubeDB</a></li><li><a href=https://appscode.com/products/stash/>Stash</a></li><li><a href=https://kubevault.com>KubeVault</a></li><li><a href=https://appscode.com/products/voyager/>Voyager</a></li><li><a href=https://appscode.com/products/guard/>Guard</a></li><li><a href=https://pharmer.io>Pharmer</a></li></ul></div></div></div><div class="column is-2"><div class=single-footer-widget><div class=footer-menu><h4>Services</h4><ul class=footer-link><li><a href=https://appscode.com/pricing/>Commercial Support</a></li><li><a href=https://appscode.com/consulting/>Consulting</a></li><li><a href=https://appscode.com/training/>Training</a></li><li><a href=https://appscode.com/support/>Support</a></li></ul></div></div></div><div class="column is-2"><div class=single-footer-widget><div class=footer-menu><h4>Company</h4><ul class=footer-link><li><a href=https://appscode.com/about/>About Us</a></li><li><a href=https://blog.byte.builders>Blog</a></li><li><a href=https://appscode.com/contact/>Contact Us</a></li></ul></div></div></div><div class="column is-2"><div class=single-footer-widget><div class=footer-menu><h4>Legal</h4><ul class=footer-link><li><a href=https://appscode.com/legal/tos/>Terms of Sevice</a></li><li><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a></li><li><a href=https://appscode.com/legal/security/>Security</a></li><li><a href=https://appscode.com/legal/sla/>Service Level Agreement</a></li></ul></div></div></div></div></div></div><div class=footer-bottom><div class="container section"><div class=columns><div class="column is-4"><p>© 2019 AppsCode Inc. All rights reserved.</p></div><div class="column is-4 is-mobile has-text-centered"><div class=footer-inline-link><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a>
<a href=https://appscode.com/legal/tos/>Terms of Service</a></div></div><div class="column is-4 is-mobile has-text-right"><div class=socail-link-inline><ul><li><a href=https://twitter.com/AppsCodeHQ><i class="fa fa-twitter" aria-hidden=true></i></a></li><li><a href=https://www.facebook.com/appscode><i class="fa fa-facebook" aria-hidden=true></i></a></li><li><a href=https://www.youtube.com/c/AppsCodeInc><i class="fa fa-youtube" aria-hidden=true></i></a></li></ul></div></div></div></div></div></footer><script src=/assets/js/bulma-carousel.min.js></script><script src=/assets/js/main.js></script></body></html>