<!doctype html><html lang=en><head><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-62096468-4','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#4D4DCB"><title>KubeDB by AppsCode</title><meta name=description content="KubeDB by AppsCode simplifies and automates routine database tasks such as provisioning, patching, backup, recovery, failure detection, and repair for various popular databases on private and public clouds"><meta name=author content="AppsCode Inc."><meta name=keywords content="kubernetes appscode databsse high availability postgres elasticsearch etcd memecached mongodb mysql percona xtradb redis"><link rel=apple-touch-icon sizes=57x57 href=/assets/images/products/kubedb/icons/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/assets/images/products/kubedb/icons/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/assets/images/products/kubedb/icons/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/assets/images/products/kubedb/icons/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/assets/images/products/kubedb/icons/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/assets/images/products/kubedb/icons/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/assets/images/products/kubedb/icons/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/assets/images/products/kubedb/icons/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/assets/images/products/kubedb/icons/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/assets/images/products/kubedb/icons/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/assets/images/products/kubedb/icons/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/assets/images/products/kubedb/icons/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/assets/images/products/kubedb/icons/favicon-16x16.png><link rel=manifest href=/assets/images/products/kubedb/icons/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/assets/images/products/kubedb/icons/ms-icon-144x144.png"><meta itemprop=name content="KubeDB by AppsCode"><meta itemprop=description content="KubeDB by AppsCode simplifies and automates routine database tasks such as provisioning, patching, backup, recovery, failure detection, and repair for various popular databases on private and public clouds"><meta itemprop=image content="https://kubedb.com/assets/images/products/kubedb/kubedb-1280x640.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeDB"><meta name=twitter:title content="KubeDB by AppsCode"><meta name=twitter:creator content="@KubeDB"><meta name=twitter:description content="KubeDB by AppsCode simplifies and automates routine database tasks such as provisioning, patching, backup, recovery, failure detection, and repair for various popular databases on private and public clouds"><meta name=twitter:image:src content="https://kubedb.com/assets/images/products/kubedb/kubedb-1280x640.png"><meta property="og:url" content="https://kubedb.com"><meta property="og:title" content="KubeDB by AppsCode"><meta property="og:description" content="KubeDB by AppsCode simplifies and automates routine database tasks such as provisioning, patching, backup, recovery, failure detection, and repair for various popular databases on private and public clouds"><meta property="og:site_name" content="KubeDB by AppsCode"><meta property="og:image" content="https://kubedb.com/assets/images/products/kubedb/kubedb-1280x640.png"><meta property="og:type" content="article"><link rel=stylesheet href=/assets/css/font-awesome.min.css><link href=https://unpkg.com/aos@2.3.1/dist/aos.css rel=stylesheet><link rel=stylesheet href=/assets/css/bulma-carousel.min.css><link rel=stylesheet href=/assets/css/bulma-tooltip.min.css><link rel=stylesheet href=/assets/css/bulma.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/keen-slider@latest/keen-slider.min.css><link rel=stylesheet href=/assets/sass/main.min.5d2c0297a6ff960daed9d0bfe02ddc681d62b160aafc866ad48d2745f78048d9.css></head><body class=kubedb><header><div class=header-top><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://appscode.com><img src=/assets/images/products/appscode/appscode.png alt=AppsCode></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav1><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav1 class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Products</a><div class=ac-megamenu><div class=columns><div class="column is-6"><div class=columns><div class="column is-12 br-1"><a href=https://kubedb.com class="single-product-item is-kubedb"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubedb/kubedb-icon.png alt=KubeDB></div><h5>KubeDB</h5></div><div class=menu-body><p>Run production-grade Databases on Kubernetes</p></div></a><a href=https://stash.run class="single-product-item is-stash"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/stash/stash-icon.png alt=Stash></div><h5>Stash</h5></div><div class=menu-body><p>Backup your Kubernetes Stateful Applications</p></div></a><a href=https://kubevault.com class="single-product-item is-kubevault"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubevault/kubevault-icon.png alt=KubeVault></div><h5>KubeVault</h5></div><div class=menu-body><p>Tools for running HashiCorp Vault on Kubernetes</p></div></a></div></div></div><div class="column is-6"><div class=columns><div class="column is-12"><a href=https://byte.builders class="single-product-item byte-builder kd-orange"><div class=menu-header><p class=intro>Introducing....</p><h5>ByteBuilders</h5></div><div class=menu-body><p>Cloud reimagined for the age of Kubernetes</p></div><p class=learn-more-btn>Learn more
<span class=icon><i class="fa fa-long-arrow-right" aria-hidden=true></i></span></p></a><a href=https://kubeform.com class="single-product-item is-kubeform"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubeform/kubeform-icon.png alt=Kubeform></div><h5>Kubeform</h5></div><div class=menu-body><p>Provision cloud resources using Kubernetes CRDs & Terraform</p></div></a></div></div></div></div></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Open Source</a><div class=ac-megamenu><div class=columns><div class="column is-6"><div class=columns><div class="column is-12 br-1"><a href=https://voyagermesh.com class="single-product-item is-voyager"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/voyager/voyager-icon.png alt=Voyager></div><h5>Voyager</h5></div><div class=menu-body><p>Secure HAProxy Ingress Controller for
Kubernetes</p></div></a><a href=https://appscode.com/products/guard/ class="single-product-item is-guard"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/guard/guard-icon.png alt=Guard></div><h5>Guard</h5></div><div class=menu-body><p>Kubernetes Authentication WebHook Server</p></div></a><a href=https://appscode.com/products/kubed/ class="single-product-item is-kubed"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubed/kubed-icon.png alt=Kubed></div><h5>Kubed</h5></div><div class=menu-body><p>Kubernetes cluster manager daemon</p></div></a></div></div></div><div class="column is-6"><div class=columns><div class="column is-12"><a href=https://pharmer.cloud class="single-product-item is-pharmer"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/pharmer/pharmer-icon.png alt=Pharmer></div><h5>Pharmer</h5></div><div class=menu-body><p>Kubernetes Cluster Manager using Kubeadm & Cluster API</p></div></a><a href=https://appscode.com/products/swift/ class="single-product-item is-swift"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/swift/swift-icon.png alt=Swift></div><h5>Swift</h5></div><div class=menu-body><p>Ajax friendly Helm Tiller Proxy</p></div></a><a href=https://appscode.com/products/searchlight/ class="single-product-item is-searchlight"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/searchlight/searchlight-icon.png alt=Searchlight></div><h5>Searchlight</h5></div><div class=menu-body><p>Alerts for Kubernetes</p></div></a></div></div></div></div></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Services</a><div class=ac-dropdown><a class=navbar-item href=https://appscode.com/consulting/>Consulting</a>
<a class=navbar-item href=https://appscode.com/training/>Training</a>
<a class=navbar-item href=https://appscode.com/support/>Support</a></div></div><a class=navbar-item href=https://blog.byte.builders>Blog</a>
<a class=navbar-item href=https://appscode.com/contact/>Contact Us</a></div><div class=navbar-item><div class="buttons main-menu-button-top"><a class="button is-small for-chat" href=https://slack.appscode.com><span><img src=/assets/images/icon/slack.png alt></span>Slack</a>
<a class="button is-small for-support" href=https://appscode.freshdesk.com><span><img src=/assets/images/icon/chat.png alt></span>Support Portal</a></div></div></div></div></nav></div></div><div class="header-bottom-area header-area kubedb-primary-bg customize-kubedb fixed-menu"><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://kubedb.com><img src=/assets/images/products/kubedb/kubedb-white.png alt=KubeDB></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><a href=/features/ class=navbar-item>Features</a>
<a href=/pricing/ class=navbar-item>Pricing</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Databases</a><div class=ac-dropdown><a class=navbar-item href=/docs/v2021.04.16/guides/elasticsearch/>Elasticsearch</a>
<a class=navbar-item href=/docs/v2021.04.16/guides/mariadb/>MariaDB</a>
<a class=navbar-item href=/docs/v2021.04.16/guides/memcached/>Memcached</a>
<a class=navbar-item href=/docs/v2021.04.16/guides/mongodb/>MongoDB</a>
<a class=navbar-item href=/docs/v2021.04.16/guides/mysql/>MySQL</a>
<a class=navbar-item href=/docs/v2021.04.16/guides/percona-xtradb/>Percona XtraDB</a>
<a class=navbar-item href=/docs/v2021.04.16/guides/pgbouncer/>PgBouncer</a>
<a class=navbar-item href=/docs/v2021.04.16/guides/postgres/>PostgreSQL</a>
<a class=navbar-item href=/docs/v2021.04.16/guides/proxysql/>ProxySQL</a>
<a class=navbar-item href=/docs/v2021.04.16/guides/redis/>Redis</a></div></div><a href=/docs/v2021.04.16/welcome/ class=navbar-item>Documentation</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Community</a><div class=ac-dropdown><a href=https://github.com/kubedb class=navbar-item>GitHub</a>
<a href=https://twitter.com/KubeDB class=navbar-item>Twitter</a>
<a href=http://slack.kubernetes.io/ class=navbar-item>Slack</a></div></div></div><div class=navbar-item><div class="buttons main-menu-button"><img style=height:24px alt="GitHub Stars" src="https://img.shields.io/badge/dynamic/json?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=github&label=stars&query=%24.stars&url=https://github-stars.appscode.workers.dev/user/kubedb">
&nbsp;&nbsp;&nbsp;
<img style=height:24px alt="GitHub Forks" src="https://img.shields.io/badge/dynamic/json?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=github&label=forks&query=%24.forks&url=https://github-stars.appscode.workers.dev/user/kubedb">
&nbsp;&nbsp;&nbsp;
<img style=height:24px alt="Docker Pulls" src="https://img.shields.io/docker/pulls/kubedb/operator?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=docker&label=pulls"></div></div></div></div></nav></div></div><div class=documentation-menu><div class="container section"><div class=is-centered><div class="is-half has-text-centered-desktop"><div class=responsive-menu><a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav3><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><nav class=documentation-navbar><div id=acNav3 class="navbar-menu nav-menu main-menu"><div class=navbar-centered><div class=navbar-start><a href=/docs/v0.13.0-rc.0/ class=navbar-item>Welcome</a>
<a href=/docs/v0.13.0-rc.0/concepts/ class=navbar-item>Concepts</a>
<a href=/docs/v0.13.0-rc.0/setup/ class=navbar-item>Setup</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Guides</a><div class=ac-dropdown><a href=/docs/v0.13.0-rc.0/guides/elasticsearch/ class=navbar-item>Elasticsearch</a>
<a href=/docs/v0.13.0-rc.0/guides/memcached/ class=navbar-item>Memcached</a>
<a href=/docs/v0.13.0-rc.0/guides/mongodb/ class=navbar-item>MongoDB</a>
<a href=/docs/v0.13.0-rc.0/guides/mysql/ class=navbar-item>MySQL</a>
<a href=/docs/v0.13.0-rc.0/guides/postgres/ class=navbar-item>PostgreSQL</a>
<a href=/docs/v0.13.0-rc.0/guides/redis/ class=navbar-item>Redis</a></div></div><a href=/docs/v0.13.0-rc.0/reference/ class=navbar-item>Reference</a></div></div></div></nav></div></div></div></div></header><div class=documentation-area><div class="container section"><article class="message is-danger"><div class=message-body>You are looking at the documentation of a prior release. To read the documentation of the latest release, please visit <a href=/docs/latest/>here</a>.</div></article><div class=columns><div class="column is-3"><div class=kd-left-sidebar><div class=trial-button><a href=/docs/v2021.04.16/setup/ class="button is-fullwidth">Try Now for FREE!</a></div><div class=kd-version><div class=dropdown><div class=dropdown-trigger><button class="button is-fullwidth" aria-haspopup=true aria-controls=dropdown-menu3>
<span><strong class=icon><i class="fa fa-cog" aria-hidden=true></i></strong>v0.13.0-rc.0</span>
<span class="icon is-small"><i class="fa fa-angle-down" aria-hidden=true></i></span></button></div><div class=dropdown-menu id=dropdown-menu3 role=menu><div class=dropdown-content><a href=https://github.com/kubedb/docs/tree/master/docs target=_blank class=dropdown-item>master</a>
<a href=/docs/v2021.04.16/ class=dropdown-item>v2021.04.16<div class=tag>Latest</div></a><a href=/docs/v2021.03.17/ class=dropdown-item>v2021.03.17</a>
<a href=/docs/v2021.01.26/ class=dropdown-item>v2021.01.26</a>
<a href=/docs/v2021.01.15/ class=dropdown-item>v2021.01.15</a>
<a href=/docs/v2021.01.02-rc.0/ class=dropdown-item>v2021.01.02-rc.0</a>
<a href=/docs/v2020.12.10/ class=dropdown-item>v2020.12.10</a>
<a href=/docs/v2020.11.12/ class=dropdown-item>v2020.11.12</a>
<a href=/docs/v2020.11.11/ class=dropdown-item>v2020.11.11</a>
<a href=/docs/v2020.11.08/ class=dropdown-item>v2020.11.08</a>
<a href=/docs/v2020.10.28/ class=dropdown-item>v2020.10.28</a>
<a href=/docs/v0.13.0-rc.0/ class=dropdown-item>v0.13.0-rc.0</a>
<a href=/docs/0.12.0/ class=dropdown-item>0.12.0</a></div></div></div></div><div class=kd-sidebar-menu><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-1>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-1><a href=/docs/v0.13.0-rc.0/guides/>PostgreSQL</a></label></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-2>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-2><a href=/docs/v0.13.0-rc.0/guides/postgres/>Postgres</a></label></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-3>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-3><a>Quickstart</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v0.13.0-rc.0/guides/postgres/quickstart/quickstart/>Overview</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/quickstart/rbac/>RBAC</a></li></ul></div></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-4>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-4><a>Clustering</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v0.13.0-rc.0/guides/postgres/clustering/ha_cluster/>HA Setup</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/clustering/streaming_replication/>Streaming Replication</a></li></ul></div></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-5>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-5><a>Snapshotting</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v0.13.0-rc.0/guides/postgres/snapshot/instant_backup/>Instant Backup</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/snapshot/scheduled_backup/>Scheduled Backup</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/snapshot/continuous_archiving/>WAL Archiving</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/snapshot/archiving_to_s3/>WAL Archiving to S3</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/snapshot/archiving_to_azure/>WAL Archiving to Azure</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/snapshot/archiving_to_gcs/>WAL Archiving to GCS</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/snapshot/archiving_to_swift/>WAL Archiving to Swift</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/snapshot/archiving_to_local/>WAL Archiving to Local Storage</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/snapshot/archiving_to_minio/>WAL Archiving to MinIO</a></li></ul></div></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-6>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-6><a>Initialization</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v0.13.0-rc.0/guides/postgres/initialization/script_source/>Using Script</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/initialization/snapshot_source/>From Snapshot</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/initialization/point-in-time-recovery/>Point-in-Time Recovery</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/initialization/wal_source/>From WAL</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/initialization/replay_from_s3/>From WAL(S3)</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/initialization/replay_from_azure/>From WAL(Azure)</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/initialization/replay_from_gcs/>From WAL(GCS)</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/initialization/replay_from_swift/>From WAL(Swift)</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/initialization/replay_from_local/>From WAL(Local Storage)</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/initialization/replay_from_minio/>From WAL(MiniIO)</a></li></ul></div></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-7>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-7><a>Private Registry</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v0.13.0-rc.0/guides/postgres/private-registry/using-private-registry/>Quickstart</a></li></ul></div></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-8>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-8><a>Custom Configuration</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v0.13.0-rc.0/guides/postgres/custom-config/using-custom-config/>Quickstart</a></li></ul></div></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-9>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-9><a>Custom Versions</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v0.13.0-rc.0/guides/postgres/custom-versions/setup/>Overview</a></li></ul></div></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-10>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-10><a>Monitoring</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v0.13.0-rc.0/guides/postgres/monitoring/using-builtin-prometheus/>Builtin Prometheus Discovery</a></li><li><a href=/docs/v0.13.0-rc.0/guides/postgres/monitoring/using-coreos-prometheus-operator/>Coreos Prometheus Operator</a></li></ul></div></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-11>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-11><a>CLI</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v0.13.0-rc.0/guides/postgres/cli/cli/>Quickstart</a></li></ul></div></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-12 checked>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-12><a>Upgrading PostgreSQL</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li class=is-active><a href=/docs/v0.13.0-rc.0/guides/postgres/upgrading/manual/>Manual</a></li></ul></div></div><div class=item><input type=checkbox id=9ba62c02c3cf3ce7b1f79835ac270cf8-13>
<label for=9ba62c02c3cf3ce7b1f79835ac270cf8-13><a>Custom RBAC</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v0.13.0-rc.0/guides/postgres/custom-rbac/using-custom-rbac/>Custom RBAC</a></li></ul></div></div></div></div></div><div class="column is-7"><div class=full-info><blockquote><p>New to KubeDB? Please start <a href=/docs/v0.13.0-rc.0/concepts/README>here</a>.</p></blockquote><h1 id=kubedb-upgrade-manual>KubeDB Upgrade Manual</h1><p>This tutorial will show you how to upgrade KubeDB from previous version to 0.11.0.</p><h2 id=before-you-begin>Before You Begin</h2><p>At first, you need to have a Kubernetes cluster, and the kubectl command-line tool must be configured to communicate with your cluster. If you do not already have a cluster, you can create one by using <a href=https://github.com/kubernetes/minikube>minikube</a>.</p><p>Now, install KubeDB 0.9.0 cli on your workstation and KubeDB operator in your cluster following the steps <a href=https://kubedb.com/docs/0.9.0/setup/install/>here</a>.</p><h2 id=previous-operator-and-sample-database>Previous operator and sample database</h2><p>In this tutorial we are using helm to install kubedb 0.9.0 release. But, user can install kubedb operator from script too.</p><pre><code class=language-console data-lang=console>$ helm repo add appscode https://charts.appscode.com/stable/
$ helm repo update

# Step 1: Install kubedb operator chart
$ helm install appscode/kubedb --name kubedb-operator --version 0.9.0 \
  --namespace kube-system

# Step 2: wait until crds are registered
$ kubectl get crds -l app=kubedb -w
NAME                               AGE
dormantdatabases.kubedb.com        6s
elasticsearches.kubedb.com         12s
elasticsearchversions.kubedb.com   8s
etcds.kubedb.com                   8s
etcdversions.kubedb.com            8s
memcacheds.kubedb.com              6s
memcachedversions.kubedb.com       6s
mongodbs.kubedb.com                7s
mongodbversions.kubedb.com         6s
mysqls.kubedb.com                  7s
mysqlversions.kubedb.com           7s
postgreses.kubedb.com              8s
postgresversions.kubedb.com        7s
redises.kubedb.com                 6s
redisversions.kubedb.com           6s
snapshots.kubedb.com               6s

# Step 3(a): Install KubeDB catalog of database versions
$ helm install appscode/kubedb-catalog --name kubedb-catalog --version 0.9.0 \
  --namespace kube-system

# Step 3(b): Or, if previously installed, upgrade KubeDB catalog of database versions
$ helm upgrade kubedb-catalog appscode/kubedb-catalog --version 0.9.0 \
  --namespace kube-system

$ helm ls
NAME           	REVISION	UPDATED                 	STATUS  	CHART               	APP VERSION	NAMESPACE
kubedb-catalog 	1       	Fri Feb  8 11:21:34 2019	DEPLOYED	kubedb-catalog-0.9.0	0.9.0      	kube-system
kubedb-operator	1       	Fri Feb  8 11:18:46 2019	DEPLOYED	kubedb-0.9.0        	0.9.0      	kube-system
</code></pre><p>Also a sample Postgres database (with scheduled backups) compatible with kubedb-0.9.0 to examine successful upgrade. Read the guide <a href=https://kubedb.com/docs/0.9.0/guides/postgres/snapshot/scheduled_backup/#create-postgres-with-backupschedule>here</a> to learn about scheduled backup in details.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubedb.com/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Postgres</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>scheduled-pg</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;9.6-v1&#34;</span>
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
  <span style=color:#f92672>standbyMode</span>: <span style=color:#ae81ff>Hot</span>
  <span style=color:#f92672>storage</span>:
    <span style=color:#f92672>storageClassName</span>: <span style=color:#e6db74>&#34;standard&#34;</span>
    <span style=color:#f92672>accessModes</span>:
    - <span style=color:#ae81ff>ReadWriteOnce</span>
    <span style=color:#f92672>resources</span>:
      <span style=color:#f92672>requests</span>:
        <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>50Mi</span>
  <span style=color:#f92672>backupSchedule</span>:
    <span style=color:#f92672>cronExpression</span>: <span style=color:#e6db74>&#34;@every 1m&#34;</span>
    <span style=color:#f92672>storageSecretName</span>: <span style=color:#ae81ff>gcs-secret</span>
    <span style=color:#f92672>gcs</span>:
      <span style=color:#f92672>bucket</span>: <span style=color:#ae81ff>kubedb-qa</span>
</code></pre></div><p>Now create secret and deploy database.</p><pre><code class=language-console data-lang=console>$ kubectl create ns demo
namespace/demo created

$ kubectl create secret -n demo generic gcs-secret \
    --from-file=./GOOGLE_PROJECT_ID \
    --from-file=./GOOGLE_SERVICE_ACCOUNT_JSON_KEY
secret/gcs-secret created

$ kubectl create -f scheduled-pg.yaml
postgres.kubedb.com/scheduled-pg created
</code></pre><p>See running scheduled snapshots,</p><pre><code class=language-console data-lang=console>$ kubectl get snap -n demo
NAME                           DATABASENAME   STATUS      AGE
scheduled-pg-20190208-053512   scheduled-pg   Succeeded   5m
scheduled-pg-20190208-053612   scheduled-pg   Succeeded   4m
scheduled-pg-20190208-053712   scheduled-pg   Succeeded   3m
scheduled-pg-20190208-053812   scheduled-pg   Succeeded   2m
scheduled-pg-20190208-053912   scheduled-pg   Succeeded   1m
scheduled-pg-20190208-054012   scheduled-pg   Succeeded   29s
</code></pre><p>Node status:</p><pre><code class=language-console data-lang=console>$ kubectl get pods -n demo --show-labels
NAME             READY   STATUS    RESTARTS   AGE   LABELS
scheduled-pg-0   1/1     Running   0          16m   controller-revision-hash=scheduled-pg-75f67456c9,kubedb.com/kind=Postgres,kubedb.com/name=scheduled-pg,kubedb.com/role=primary,statefulset.kubernetes.io/pod-name=scheduled-pg-0
scheduled-pg-1   1/1     Running   0          15m   controller-revision-hash=scheduled-pg-75f67456c9,kubedb.com/kind=Postgres,kubedb.com/name=scheduled-pg,kubedb.com/role=replica,statefulset.kubernetes.io/pod-name=scheduled-pg-1
scheduled-pg-2   1/1     Running   0          15m   controller-revision-hash=scheduled-pg-75f67456c9,kubedb.com/kind=Postgres,kubedb.com/name=scheduled-pg,kubedb.com/role=replica,statefulset.kubernetes.io/pod-name=scheduled-pg-2
</code></pre><h3 id=connect-with-postgresql-database>Connect with PostgreSQL database</h3><p>Now, you can connect to this database using <code>scheduled-pg.demo</code> service and <em>password</em> created in <code>scheduled-pg-auth</code> secret.</p><p><strong>Connection information:</strong></p><ul><li><p>Host name/address: you can use any of these</p><ul><li>Service: <code>scheduled-pg.demo</code></li><li>Pod IP: (<code>$ kubectl get pods scheduled-pg-0 -n demo -o yaml | grep podIP</code>)</li></ul><p>But, In this tutorial we will exec into each pod to insert data and see data availability in replica nodes. So, <code>localhost</code> as host is fine.</p></li><li><p>Port: <code>5432</code></p></li><li><p>Maintenance database: <code>postgres</code></p></li><li><p>Username: <code>postgres</code></p></li><li><p>Password: Run the following command to get <em>password</em>,</p><pre><code class=language-console data-lang=console>$ kubectl get secrets -n demo scheduled-pg-auth -o jsonpath='{.data.\POSTGRES_PASSWORD}' | base64 -d
xfd0mqa3S2Ir0tTP
</code></pre></li></ul><h3 id=connect-to-master-node-through-cli>Connect to master-node through cli</h3><pre><code class=language-console data-lang=console>$ kubectl exec -it -n demo scheduled-pg-0 bash

bash-4.3# psql -h localhost -U postgres

postgres=# \l
                                 List of databases
   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges
-----------+----------+----------+------------+------------+-----------------------
 postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
 template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
(3 rows)
</code></pre><p>Postgres replication state</p><pre><code class=language-console data-lang=console>postgres=# SELECT * FROM pg_stat_replication;
 pid | usesysid | usename  | application_name | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   | sent_location | write_location | flush_location | replay_location | sync_priority | sync_state
-----+----------+----------+------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+---------------+----------------+----------------+-----------------+---------------+------------
  59 |       10 | postgres | scheduled-pg-1   | 172.17.0.10 |                 |       38916 | 2019-02-08 05:24:47.575398+00 |              | streaming | 0/4000300     | 0/4000300      | 0/4000300      | 0/4000300       |             0 | async
  63 |       10 | postgres | scheduled-pg-2   | 172.17.0.11 |                 |       59954 | 2019-02-08 05:24:51.028714+00 |              | streaming | 0/4000300     | 0/4000300      | 0/4000300      | 0/4000300       |             0 | async
(2 rows)
</code></pre><p>Insert data</p><pre><code class=language-console data-lang=console>postgres=# CREATE DATABASE testdb;
CREATE DATABASE

postgres=# \l
                                 List of databases
   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges
-----------+----------+----------+------------+------------+-----------------------
 postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
 template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 testdb    | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
(4 rows)

postgres=# \c testdb
You are now connected to database &quot;testdb&quot; as user &quot;postgres&quot;.

testdb=# \d
No relations found.

testdb=# CREATE TABLE COMPANY(
   ID INT PRIMARY KEY     NOT NULL,
   NAME           TEXT    NOT NULL,
   AGE            INT     NOT NULL,
   ADDRESS        CHAR(50),
   SALARY         REAL,
   JOIN_DATE	  DATE
);
CREATE TABLE

testdb=# \d
          List of relations
 Schema |  Name   | Type  |  Owner
--------+---------+-------+----------
 public | company | table | postgres
(1 row)

testdb=# INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY,JOIN_DATE) VALUES (1, 'Paul', 32, 'California', 20000.00,'2001-07-13'), (2, 'Allen', 25, 'Texas', 20000.00, '2007-12-13'),(3, 'Teddy', 23, 'Norway', 20000.00, '2007-12-13' ), (4, 'Mark', 25, 'Rich-Mond ', 65000.00, '2007-12-13' ), (5, 'David', 27, 'Texas', 85000.00, '2007-12-13');
INSERT 0 5

testdb=# SELECT * FROM company;
 id | name  | age |                      address                       | salary | join_date
----+-------+-----+----------------------------------------------------+--------+------------
  1 | Paul  |  32 | California                                         |  20000 | 2001-07-13
  2 | Allen |  25 | Texas                                              |  20000 | 2007-12-13
  3 | Teddy |  23 | Norway                                             |  20000 | 2007-12-13
  4 | Mark  |  25 | Rich-Mond                                          |  65000 | 2007-12-13
  5 | David |  27 | Texas                                              |  85000 | 2007-12-13
(5 rows)
</code></pre><p>Exit from postgres cli</p><pre><code class=language-console data-lang=console>testdb=# \q
bash-4.3# exit
exit
</code></pre><h3 id=connect-to-replica-node-1-through-cli>Connect to replica-node-1 through cli</h3><p>Connect to <code>scheduled-pg-1</code> and see availability of data</p><pre><code class=language-console data-lang=console>$ kubectl exec -it -n demo scheduled-pg-1 bash

bash-4.3# psql -h localhost -U postgres
psql (9.6.7)
Type &quot;help&quot; for help.

postgres=# \l
                                 List of databases
   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges
-----------+----------+----------+------------+------------+-----------------------
 postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
 template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 testdb    | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
(4 rows)

postgres=# \c testdb
You are now connected to database &quot;testdb&quot; as user &quot;postgres&quot;.

testdb=# \d
          List of relations
 Schema |  Name   | Type  |  Owner
--------+---------+-------+----------
 public | company | table | postgres
(1 row)

testdb=# SELECT * FROM company;
 id | name  | age |                      address                       | salary | join_date
----+-------+-----+----------------------------------------------------+--------+------------
  1 | Paul  |  32 | California                                         |  20000 | 2001-07-13
  2 | Allen |  25 | Texas                                              |  20000 | 2007-12-13
  3 | Teddy |  23 | Norway                                             |  20000 | 2007-12-13
  4 | Mark  |  25 | Rich-Mond                                          |  65000 | 2007-12-13
  5 | David |  27 | Texas                                              |  85000 | 2007-12-13
(5 rows)
</code></pre><h3 id=connect-to-replica-node-2-through-cli>Connect to replica-node-2 through cli</h3><p>Connect to <code>scheduled-pg-2</code> and see availability of data</p><pre><code class=language-console data-lang=console>$ kubectl exec -it -n demo scheduled-pg-2 bash
bash-4.3# psql -h localhost -U postgres
psql (9.6.7)
Type &quot;help&quot; for help.

postgres=# \l
                                 List of databases
   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges
-----------+----------+----------+------------+------------+-----------------------
 postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
 template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 testdb    | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
(4 rows)

postgres=# \c testdb
You are now connected to database &quot;testdb&quot; as user &quot;postgres&quot;.

testdb=# \d
          List of relations
 Schema |  Name   | Type  |  Owner
--------+---------+-------+----------
 public | company | table | postgres
(1 row)

testdb=# SELECT * FROM company;
 id | name  | age |                      address                       | salary | join_date
----+-------+-----+----------------------------------------------------+--------+------------
  1 | Paul  |  32 | California                                         |  20000 | 2001-07-13
  2 | Allen |  25 | Texas                                              |  20000 | 2007-12-13
  3 | Teddy |  23 | Norway                                             |  20000 | 2007-12-13
  4 | Mark  |  25 | Rich-Mond                                          |  65000 | 2007-12-13
  5 | David |  27 | Texas                                              |  85000 | 2007-12-13
(5 rows)

testdb=# \q
bash-4.3# exit
exit
</code></pre><h2 id=upgrade-kubedb-operator>Upgrade kubedb-operator</h2><p>For helm, <code>upgrade</code> command works fine.</p><pre><code class=language-console data-lang=console>$ helm upgrade --install kubedb-operator appscode/kubedb --version 0.11.0 --namespace kube-system
$ helm upgrade --install kubedb-catalog appscode/kubedb-catalog --version 0.11.0 --namespace kube-system

$ helm ls
NAME           	REVISION	UPDATED                 	STATUS  	CHART               	APP VERSION	NAMESPACE
kubedb-catalog 	2       	Fri Feb  8 12:12:45 2019	DEPLOYED	kubedb-catalog-0.11.0	0.11.0      	kube-system
kubedb-operator	2       	Fri Feb  8 12:11:57 2019	DEPLOYED	kubedb-0.11.0        	0.11.0      	kube-system
</code></pre><p>For Bash script installation, uninstall first, then install again with 0.11.0 script. See <a href=https://kubedb.com/docs/0.9.0/setup/install/>0.9.0 installation guide</a>.</p><h2 id=stale-crd-objects>Stale CRD objects</h2><p>At this state, the operator is skipping this <code>scheduled-pg</code> Postgres. Because, Postgres version <code>9.6-v1</code> is deprecated in <code>kubedb 0.11.0</code>. You can see the skipped event message in postgres database event.</p><pre><code class=language-console data-lang=console>$ kubedb describe pg -n demo scheduled-pg
....

Events:
  Type     Reason              Age   From             Message
  ----     ------              ----  ----             -------
  ...
  Normal   Starting            22m   KubeDB operator  Backup running
  Normal   SuccessfulSnapshot  22m   KubeDB operator  Successfully completed snapshot
  Normal   Successful          21m   KubeDB operator  Successfully patched StatefulSet
  Normal   Successful          21m   KubeDB operator  Successfully patched Postgres
  Warning  Invalid             4m    KubeDB operator  postgres demo/scheduled-pg is using deprecated version 9.6-v1. Skipped processing
</code></pre><p>The scheduled snapshot also in paused state.</p><pre><code class=language-concole data-lang=concole>$ kubectl get snap -n demo
NAME                           DATABASENAME   STATUS      AGE
...
scheduled-pg-20190208-060615   scheduled-pg   Succeeded   23m
scheduled-pg-20190208-060715   scheduled-pg   Succeeded   22m
scheduled-pg-20190208-060815   scheduled-pg   Succeeded   21m
scheduled-pg-20190208-060915   scheduled-pg   Succeeded   20m
scheduled-pg-20190208-061015   scheduled-pg   Succeeded   19m
scheduled-pg-20190208-061115   scheduled-pg   Succeeded   18m
</code></pre><p>Some other fields in CRD also got deprecated and some are added. The good thing is, kubedb operator will handle those changes in it&rsquo;s mutating webhook. (So, always try to run kubedb with webhooks enabled). But, user has to update the db-version on his own.</p><h2 id=upgrade-crd-objects>Upgrade CRD objects</h2><p>Note that, Once the DB version is updated, kubedb-operator will update the statefulsets too. This update strategy can be modified by <code>spec.updateStrategy</code>. Read <a href=https://kubedb.com/docs/0.9.0/concepts/databases/postgres/#spec-updatestrategy>here</a> for details about updateStrategy.</p><p>Now, Before updating CRD, find Available PostgresVersion.</p><pre><code class=language-console data-lang=console>$ kubectl get postgresversions
NAME       VERSION   DB_IMAGE                   DEPRECATED   AGE
10.2       10.2      kubedb/postgres:10.2       true         57m
10.2-v1    10.2      kubedb/postgres:10.2-v2    true         57m
10.2-v2    10.2      kubedb/postgres:10.2-v3                 6m
10.6       10.6      kubedb/postgres:10.6                    6m
11.1       11.1      kubedb/postgres:11.1                    6m
9.6        9.6       kubedb/postgres:9.6        true         57m
9.6-v1     9.6       kubedb/postgres:9.6-v2     true         57m
9.6-v2     9.6       kubedb/postgres:9.6-v3                  6m
9.6.7      9.6.7     kubedb/postgres:9.6.7      true         57m
9.6.7-v1   9.6.7     kubedb/postgres:9.6.7-v2   true         57m
9.6.7-v2   9.6.7     kubedb/postgres:9.6.7-v3                6m
</code></pre><p>Notice the <code>DEPRECATED</code> column. Here, <code>true</code> means that this PostgresVersion is deprecated for current KubeDB version. KubeDB will not work for deprecated PostgresVersion. To know more about what is <code>PostgresVersion</code> crd and why there is <code>10.2</code> and <code>10.2-v2</code> variation, please visit <a href=/docs/v0.13.0-rc.0/concepts/catalog/postgres>here</a>.</p><p>Now, Update the CRD and set <code>Spec.version</code> to <code>9.6-v2</code>.</p><pre><code class=language-console data-lang=console>kubectl edit pg -n demo scheduled-pg
</code></pre><p>See the changed object (defaulted).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ae81ff>$ kubectl get pg -n demo scheduled-pg -o yaml</span>
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubedb.com/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Postgres</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>creationTimestamp</span>: <span style=color:#e6db74>&#34;2019-02-08T05:24:08Z&#34;</span>
  <span style=color:#f92672>finalizers</span>:
  - <span style=color:#ae81ff>kubedb.com</span>
  <span style=color:#f92672>generation</span>: <span style=color:#ae81ff>5</span>
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>scheduled-pg</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
  <span style=color:#f92672>resourceVersion</span>: <span style=color:#e6db74>&#34;18594&#34;</span>
  <span style=color:#f92672>selfLink</span>: <span style=color:#ae81ff>/apis/kubedb.com/v1alpha1/namespaces/demo/postgreses/scheduled-pg</span>
  <span style=color:#f92672>uid</span>: <span style=color:#ae81ff>c2a335ed-2b61-11e9-884f-080027973433</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>backupSchedule</span>:
    <span style=color:#f92672>cronExpression</span>: <span style=color:#e6db74>&#39;@every 1m&#39;</span>
    <span style=color:#f92672>gcs</span>:
      <span style=color:#f92672>bucket</span>: <span style=color:#ae81ff>kubedb-qa</span>
    <span style=color:#f92672>podTemplate</span>:
      <span style=color:#f92672>controller</span>: {}
      <span style=color:#f92672>metadata</span>: {}
      <span style=color:#f92672>spec</span>:
        <span style=color:#f92672>resources</span>: {}
    <span style=color:#f92672>storageSecretName</span>: <span style=color:#ae81ff>gcs-secret</span>
  <span style=color:#f92672>databaseSecret</span>:
    <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>scheduled-pg-auth</span>
  <span style=color:#f92672>leaderElection</span>:
    <span style=color:#f92672>leaseDurationSeconds</span>: <span style=color:#ae81ff>15</span>
    <span style=color:#f92672>renewDeadlineSeconds</span>: <span style=color:#ae81ff>10</span>
    <span style=color:#f92672>retryPeriodSeconds</span>: <span style=color:#ae81ff>2</span>
  <span style=color:#f92672>podTemplate</span>:
    <span style=color:#f92672>controller</span>: {}
    <span style=color:#f92672>metadata</span>: {}
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>resources</span>: {}
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
  <span style=color:#f92672>serviceTemplate</span>:
    <span style=color:#f92672>metadata</span>: {}
    <span style=color:#f92672>spec</span>: {}
  <span style=color:#f92672>standbyMode</span>: <span style=color:#ae81ff>Hot</span>
  <span style=color:#f92672>storage</span>:
    <span style=color:#f92672>accessModes</span>:
    - <span style=color:#ae81ff>ReadWriteOnce</span>
    <span style=color:#f92672>dataSource</span>: <span style=color:#66d9ef>null</span>
    <span style=color:#f92672>resources</span>:
      <span style=color:#f92672>requests</span>:
        <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>50Mi</span>
    <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>standard</span>
  <span style=color:#f92672>storageType</span>: <span style=color:#ae81ff>Durable</span>
  <span style=color:#f92672>terminationPolicy</span>: <span style=color:#ae81ff>Pause</span>
  <span style=color:#f92672>updateStrategy</span>:
    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>RollingUpdate</span>
  <span style=color:#f92672>version</span>: <span style=color:#ae81ff>9.6</span>-<span style=color:#ae81ff>v2</span>
<span style=color:#f92672>status</span>:
  <span style=color:#f92672>observedGeneration</span>: <span style=color:#ae81ff>5</span><span style=color:#ae81ff>$4214054550087021099</span>
  <span style=color:#f92672>phase</span>: <span style=color:#ae81ff>Running</span>
</code></pre></div><p>Watch for pod updates in <code>RollingUpdate</code> UpdateStrategy.</p><pre><code class=language-console data-lang=console>$ kubectl get po -n demo -w
NAMESPACE     NAME     READY   STATUS    RESTARTS   AGE
...
demo   scheduled-pg-2   1/1   Terminating   0     107m
demo   scheduled-pg-2   0/1   Terminating   0     107m
demo   scheduled-pg-2   0/1   Terminating   0     107m
demo   scheduled-pg-2   0/1   Terminating   0     107m
demo   scheduled-pg-2   0/1   Pending   0     0s
demo   scheduled-pg-2   0/1   Pending   0     0s
demo   scheduled-pg-2   0/1   ContainerCreating   0     0s
demo   scheduled-pg-2   0/1   ContainerCreating   0     19s
demo   scheduled-pg-2   1/1   Running   0     19s
demo   scheduled-pg-1   1/1   Terminating   0     108m
demo   scheduled-pg-1   0/1   Terminating   0     108m
demo   scheduled-pg-1   0/1   Terminating   0     108m
demo   scheduled-pg-1   0/1   Terminating   0     108m
demo   scheduled-pg-1   0/1   Pending   0     0s
demo   scheduled-pg-1   0/1   Pending   0     0s
demo   scheduled-pg-1   0/1   ContainerCreating   0     0s
demo   scheduled-pg-1   0/1   ContainerCreating   0     1s
demo   scheduled-pg-1   1/1   Running   0     2s
demo   scheduled-pg-0   1/1   Terminating   0     108m
demo   scheduled-pg-0   0/1   Terminating   0     109m
demo   scheduled-pg-0   0/1   Terminating   0     109m
demo   scheduled-pg-0   0/1   Terminating   0     109m
demo   scheduled-pg-0   0/1   Pending   0     0s
demo   scheduled-pg-0   0/1   Pending   0     0s
demo   scheduled-pg-0   0/1   ContainerCreating   0     0s
demo   scheduled-pg-0   0/1   ContainerCreating   0     1s
demo   scheduled-pg-0   1/1   Running   0     2s
</code></pre><p>Watch for statefulset states.</p><pre><code class=language-console data-lang=console>$ kubectl get statefulset -n demo -w
NAME           READY   AGE
scheduled-pg   3/3     105m
scheduled-pg   3/3   107m
scheduled-pg   3/3   107m
scheduled-pg   2/3   107m
scheduled-pg   2/3   107m
scheduled-pg   3/3   108m
scheduled-pg   2/3   108m
scheduled-pg   2/3   108m
scheduled-pg   3/3   108m
scheduled-pg   2/3   109m
scheduled-pg   2/3   109m
scheduled-pg   3/3   109m
</code></pre><p>The scheduled snapshot is in working state now.</p><pre><code class=language-console data-lang=console>$ kubectl get snap -n demo
NAME                           DATABASENAME   STATUS      AGE
...
scheduled-pg-20190208-060715   scheduled-pg   Succeeded   32m
scheduled-pg-20190208-060815   scheduled-pg   Succeeded   31m
scheduled-pg-20190208-060915   scheduled-pg   Succeeded   30m
scheduled-pg-20190208-061015   scheduled-pg   Succeeded   29m
scheduled-pg-20190208-061115   scheduled-pg   Succeeded   28m
scheduled-pg-20190208-063804   scheduled-pg   Succeeded   1m
scheduled-pg-20190208-063904   scheduled-pg   Succeeded   47s
</code></pre><h2 id=varify-data-persistence>Varify Data persistence</h2><h3 id=connect-to-master-node>Connect to master-node</h3><p>Get master node</p><pre><code class=language-console data-lang=console>$ kubectl get pods -n demo --selector=&quot;kubedb.com/role=primary&quot;
NAME             READY   STATUS    RESTARTS   AGE
scheduled-pg-0   1/1     Running   0          3m12s
</code></pre><p>Exec into postgres master</p><pre><code class=language-console data-lang=console>$ kubectl exec -it -n demo scheduled-pg-0 bash

bash-4.3# psql -h localhost -U postgres

</code></pre><p>Postgres replication state</p><pre><code class=language-console data-lang=console>postgres=# SELECT * FROM pg_stat_replication;
 pid | usesysid | usename  | application_name | client_addr | client_hostname | client_port |         backend_start         | backend_xmin |   state   | sent_location | write_location | flush_location | replay_location | sync_priority | sync_state
-----+----------+----------+------------------+-------------+-----------------+-------------+-------------------------------+--------------+-----------+---------------+----------------+----------------+-----------------+---------------+------------
  27 |       10 | postgres | scheduled-pg-1   | 172.17.0.10 |                 |       40084 | 2019-02-08 06:39:16.160849+00 |              | streaming | 0/C000108     | 0/C000108      | 0/C000108      | 0/C000108       |             0 | async
  42 |       10 | postgres | scheduled-pg-2   | 172.17.0.11 |                 |       33624 | 2019-02-08 06:41:12.778783+00 |              | streaming | 0/C000108     | 0/C000108      | 0/C000108      | 0/C000108       |             0 | async
(2 rows)
</code></pre><p>Data availability</p><pre><code class=language-console data-lang=console>postgres=# \l
                                 List of databases
   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges
-----------+----------+----------+------------+------------+-----------------------
 postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
 template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 testdb    | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
(4 rows)

postgres=# \c testdb
You are now connected to database &quot;testdb&quot; as user &quot;postgres&quot;.

testdb=# \d
          List of relations
 Schema |  Name   | Type  |  Owner
--------+---------+-------+----------
 public | company | table | postgres
(1 row)

testdb=# SELECT * FROM company;
 id | name  | age |                      address                       | salary | join_date
----+-------+-----+----------------------------------------------------+--------+------------
  1 | Paul  |  32 | California                                         |  20000 | 2001-07-13
  2 | Allen |  25 | Texas                                              |  20000 | 2007-12-13
  3 | Teddy |  23 | Norway                                             |  20000 | 2007-12-13
  4 | Mark  |  25 | Rich-Mond                                          |  65000 | 2007-12-13
  5 | David |  27 | Texas                                              |  85000 | 2007-12-13
(5 rows)


testdb=# \q
bash-4.3# exit
exit
</code></pre><h3 id=connect-to-replica-node-1>Connect to replica-node-1</h3><p>Connect to <code>scheduled-pg-1</code> and see availability of data</p><pre><code class=language-console data-lang=console>$ kubectl exec -it -n demo scheduled-pg-1 bash

bash-4.3# psql -h localhost -U postgres

postgres=# \l
                                 List of databases
   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges
-----------+----------+----------+------------+------------+-----------------------
 postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
 template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 testdb    | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
(4 rows)

postgres=# \c testdb
You are now connected to database &quot;testdb&quot; as user &quot;postgres&quot;.

testdb=# \d
          List of relations
 Schema |  Name   | Type  |  Owner
--------+---------+-------+----------
 public | company | table | postgres
(1 row)

testdb=# SELECT * FROM company;
 id | name  | age |                      address                       | salary | join_date
----+-------+-----+----------------------------------------------------+--------+------------
  1 | Paul  |  32 | California                                         |  20000 | 2001-07-13
  2 | Allen |  25 | Texas                                              |  20000 | 2007-12-13
  3 | Teddy |  23 | Norway                                             |  20000 | 2007-12-13
  4 | Mark  |  25 | Rich-Mond                                          |  65000 | 2007-12-13
  5 | David |  27 | Texas                                              |  85000 | 2007-12-13
(5 rows)
</code></pre><h3 id=connect-to-replica-node-2>Connect to replica-node-2</h3><p>Connect to <code>scheduled-pg-2</code> and see availability of data</p><pre><code class=language-console data-lang=console>$ kubectl exec -it -n demo scheduled-pg-2 bash

bash-4.3# psql -h localhost -U postgres


postgres=# \l
                                 List of databases
   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges
-----------+----------+----------+------------+------------+-----------------------
 postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
 template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 testdb    | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
(4 rows)

postgres=# \c testdb
You are now connected to database &quot;testdb&quot; as user &quot;postgres&quot;.

testdb=# \d
          List of relations
 Schema |  Name   | Type  |  Owner
--------+---------+-------+----------
 public | company | table | postgres
(1 row)

testdb=# SELECT * FROM company;
 id | name  | age |                      address                       | salary | join_date
----+-------+-----+----------------------------------------------------+--------+------------
  1 | Paul  |  32 | California                                         |  20000 | 2001-07-13
  2 | Allen |  25 | Texas                                              |  20000 | 2007-12-13
  3 | Teddy |  23 | Norway                                             |  20000 | 2007-12-13
  4 | Mark  |  25 | Rich-Mond                                          |  65000 | 2007-12-13
  5 | David |  27 | Texas                                              |  85000 | 2007-12-13
(5 rows)

testdb=# \q
bash-4.3# exit
exit
</code></pre><h2 id=cleaning-up>Cleaning up</h2><p>To cleanup the Kubernetes resources created by this tutorial, run:</p><pre><code class=language-console data-lang=console>kubectl patch -n demo pg/scheduled-pg -p '{&quot;spec&quot;:{&quot;terminationPolicy&quot;:&quot;WipeOut&quot;}}' --type=&quot;merge&quot;
kubectl delete -n demo pg/scheduled-pg

kubectl delete ns demo
</code></pre><h2 id=next-steps>Next Steps</h2><ul><li>Learn about <a href=/docs/v0.13.0-rc.0/guides/postgres/custom-versions/setup>custom PostgresVersions</a>.</li><li>Want to setup PostgreSQL cluster? Check how to <a href=/docs/v0.13.0-rc.0/guides/postgres/clustering/ha_cluster>configure Highly Available PostgreSQL Cluster</a></li><li>Detail concepts of <a href=/docs/v0.13.0-rc.0/concepts/databases/postgres>Postgres object</a>.</li><li>Detail concepts of <a href=/docs/v0.13.0-rc.0/concepts/snapshot>Snapshot object</a>.</li><li>Want to hack on KubeDB? Check our <a href=/docs/v0.13.0-rc.0/CONTRIBUTING>contribution guidelines</a>.</li></ul></div></div><div class="column is-2"><div class=right-sidebar-area><div class=search-area><form action=#><input id=acSearch type=text placeholder=Search...>
<button class=search-button>
<i class="fa fa-search" aria-hidden=true></i></button></form></div><div class=tbl-of-contents><h4>What's on this Page</h4><nav id=TableOfContents><ul><li><a href=#before-you-begin>Before You Begin</a></li><li><a href=#previous-operator-and-sample-database>Previous operator and sample database</a><ul><li><a href=#connect-with-postgresql-database>Connect with PostgreSQL database</a></li><li><a href=#connect-to-master-node-through-cli>Connect to master-node through cli</a></li><li><a href=#connect-to-replica-node-1-through-cli>Connect to replica-node-1 through cli</a></li><li><a href=#connect-to-replica-node-2-through-cli>Connect to replica-node-2 through cli</a></li></ul></li><li><a href=#upgrade-kubedb-operator>Upgrade kubedb-operator</a></li><li><a href=#stale-crd-objects>Stale CRD objects</a></li><li><a href=#upgrade-crd-objects>Upgrade CRD objects</a></li><li><a href=#varify-data-persistence>Varify Data persistence</a><ul><li><a href=#connect-to-master-node>Connect to master-node</a></li><li><a href=#connect-to-replica-node-1>Connect to replica-node-1</a></li><li><a href=#connect-to-replica-node-2>Connect to replica-node-2</a></li></ul></li><li><a href=#cleaning-up>Cleaning up</a></li><li><a href=#next-steps>Next Steps</a></li></ul></nav></div></div></div></div></div><script>var kdDropdown=document.querySelector(".dropdown"),kdDropdownBtn=document.querySelector(".dropdown-trigger");kdDropdownBtn.addEventListener("click",function(){kdDropdown.classList.toggle("is-active")})</script></div><div class=overlay-bg></div><div class=sidebar-search-area><div class=search-area-top><h3>Search</h3><div class=searchbar-area><input type=search name=search id=searchbox placeholder=Search...>
<button onclick=queryPage(1)><i class="fa fa-search" aria-hidden=true></i></button></div><span id=searchbar-script-container style=display:none></span><div class="search-meta-information level"><div class=level-left></div></div></div><div class=search-result-wrapper></div><div class=pagination-area><div class=pagination-list></div></div></div><div class=improve-section-area><div class="container section"><div class=improve-bg-color><div class=columns><div class="column is-6"><a href=https://github.com/kubedb/docs/edit/master/docs/guides/postgres/upgrading/manual.md/>Improve This Page</a></div></div></div></div></div><script type=text/javascript>var pageSize=5,acSearch=document.querySelector("#acSearch"),bodyOverlay=document.querySelector(".overlay-bg"),sidebarSearch=document.querySelector(".sidebar-search-area");acSearch.addEventListener("click",function(){bodyOverlay.style.display="block",sidebarSearch.style.right="0",document.getElementById("searchbox").focus(),bodyOverlay.addEventListener("click",function(){bodyOverlay.style.display="none",sidebarSearch.style.right="-80%"})});function encodeQueryData(a){var b=[],c;for(c in a)b.push(encodeURIComponent(c)+'='+encodeURIComponent(a[c]));return b.join('&')}document.querySelector(".searchbar-area input[type=search]").addEventListener("keyup",function(a){a.preventDefault(),a.keyCode===13&&queryPage(1)});function queryPage(c){var i=document.getElementById("searchbox").value,j="015199383701854252104:8mvwy0fek2e",d="AIzaSyBrcwLTnL09geNrFMUx1kpL--dT1379aag",f="small",g="renderResult",h="https://www.googleapis.com/customsearch/v1?"+encodeQueryData({q:i,cx:j,key:d,imgSize:f,callback:g,start:(c-1)*pageSize+1,num:pageSize}),a=document.createElement("script"),b;a.src=h,e=document.getElementById("searchbar-script-container"),b=e.lastElementChild,b&&e.removeChild(b),e.appendChild(a)}function renderSearchResultEntry(a){var b='<div class="single-search-result"><h3><a href="'+a.link+'">'+a.title+'</a></h3>'+'<a href="'+a.link+'">'+a.htmlFormattedUrl+'</a>'+'<div class="result-description-wrapper">';return a.pagemap&&a.pagemap.cse_thumbnail&&(b+='<div class="result-thumb"><img src="'+a.pagemap.cse_thumbnail[0].src+'" alt="" />'+'</div>'),b+='<div class="result-description"><p>'+a.snippet+'</p>'+'</div>'+'</div>'+'</div>',b}function renderResult(a){var e,d,c,b;if(document.querySelector(".search-meta-information .level-left").innerHTML='<div class="level-left"><p>About <span class="search-count">'+a.searchInformation.formattedTotalResults+'</span> results (<span class="time-count">'+a.searchInformation.formattedSearchTime+' </span>seconds)'+'</p>'+'</div>',!a.items)return;e=document.querySelector(".search-result-wrapper"),e.innerHTML="";for(d=0;d<a.items.length;d++)e.innerHTML+=renderSearchResultEntry(a.items[d]);c='<ul>',a.queries.previousPage&&(b=Math.floor(a.queries.previousPage[0].startIndex/pageSize)+1,c+='<li><a href="#" onclick="queryPage('+b+')">Previous</a></li>'),a.queries.request&&(b=Math.floor(a.queries.request[0].startIndex/pageSize)+1,c+='<li><a href="#" onclick="queryPage('+b+')" class="is-active">'+b+'</a></li>'),a.queries.nextPage&&(b=Math.floor(a.queries.nextPage[0].startIndex/pageSize)+1,c+='<li><a href="#" onclick="queryPage('+b+')">Next</a></li>'),c+='</ul>',document.querySelector(".pagination-area .pagination-list").innerHTML=c}</script><section></section><section></section><section></section><button class=go-to-top id=goTop>
<i class="fa fa-angle-up" aria-hidden=true></i></button><footer class=footer-area><div class=footer-top><div class="container section"><div class="columns is-mobile is-multiline"><div class="column is-full-mobile is-one-third-desktop is-one-third-widescreen is-one-third-tablet" data-aos=fade-up><div class=single-footer-widget><div class=footer-logo><a href=https://appscode.com><img src=/assets/images/products/appscode/appscode.png alt=AppsCode class=img></a></div><div class=subscription-form><form method=post action=https://listmonk.appscode.com/subscription/form id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=navbar-form target=_blank novalidate role=email role=email><label for=email>Subscribe to Our Newsletter</label><p class=spam-message>No spam, we promise. Your mail address is secure</p><div class="field has-addons"><div class=control><input type=hidden id=afbbc name=l value=afbbc974-e163-4467-be49-040e399520f3>
<input class=input name=email id=mce-EMAIL type=email placeholder="Your work email address" required>
<button id=mc-embedded-subscribe type=submit name=subscribe class=button>
<i class="fa fa-paper-plane-o" aria-hidden=true></i></button></div></div></form></div><div class=contact-information><h4>Have any Inquiry?</h4><ul class=all-contact-info><li><a href=callto:+1%28650%29241-8486><span><i class="fa fa-phone" aria-hidden=true></i></span>+1(650)241-8486</a></li><li><a href=mailto:support@appscode.com><span><i class="fa fa-envelope-o" aria-hidden=true></i></span>support@appscode.com</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=500><div class=single-footer-widget><div class=footer-menu><h4>Products</h4><ul class=footer-link><li><a href=https://kubedb.com>KubeDB</a></li><li><a href=https://stash.run>Stash</a></li><li><a href=https://kubevault.com>KubeVault</a></li><li><a href=https://kubeform.com>Kubeform</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=600><div class=single-footer-widget><div class=footer-menu><h4>Services</h4><ul class=footer-link><li><a href=https://appscode.com/pricing/>Pricing</a></li><li><a href=https://appscode.com/consulting/>Consulting</a></li><li><a href=https://appscode.com/training/>Training</a></li><li><a href=https://appscode.com/support/>Support</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=700><div class=single-footer-widget><div class=footer-menu><h4>Company</h4><ul class=footer-link><li><a href=https://appscode.com/about/>About Us</a></li><li><a href=https://blog.byte.builders>Blog</a></li><li><a href=https://appscode.com/contact/>Contact Us</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=800><div class=single-footer-widget><div class=footer-menu><h4>Legal</h4><ul class=footer-link><li><a href=https://appscode.com/legal/tos/>Terms of Sevice</a></li><li><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a></li><li><a href=https://appscode.com/legal/security/>Security</a></li><li><a href=https://appscode.com/legal/sla/>Service Level Agreement</a></li></ul></div></div></div></div></div></div><div class=footer-bottom><div class="container section"><div class=columns><div class="column is-4"><p> 2021 AppsCode Inc. All rights reserved.</p></div><div class="column is-4 is-mobile has-text-centered"><div class=footer-inline-link><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a>
<a href=https://appscode.com/legal/tos/>Terms of Service</a></div></div><div class="column is-4 is-mobile has-text-right"><div class=socail-link-inline><ul><li><a href=https://twitter.com/AppsCodeHQ><i class="fa fa-twitter" aria-hidden=true></i></a></li><li><a href=https://www.facebook.com/appscode><i class="fa fa-facebook" aria-hidden=true></i></a></li><li><a href=https://www.youtube.com/c/AppsCodeInc><i class="fa fa-youtube" aria-hidden=true></i></a></li></ul></div></div></div></div></div></footer><script src=/assets/js/bulma-carousel.min.js></script><script src=https://unpkg.com/aos@2.3.1/dist/aos.js></script><script src=https://unpkg.com/downloadjs@1.4.7/download.min.js></script><script src=https://unpkg.com/clipboard@2/dist/clipboard.min.js></script><script src=/assets/js/main.js></script><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/9255943.js></script><script type=text/javascript>var Tawk_API=Tawk_API||{},Tawk_LoadStart=new Date;(function(){var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];a.async=!0,a.src='https://embed.tawk.to/5821e34b18d9f16af02864b7/default',a.charset='UTF-8',a.setAttribute('crossorigin','*'),b.parentNode.insertBefore(a,b)})()</script></body></html>